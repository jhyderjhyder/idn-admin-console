<nav class="navbar navbar-expand-lg navbar-light bg-light p-3 mb-3 rounded" aria-label="breadcrumb">
  <ol class="breadcrumb m-0">
    <li class="breadcrumb-item"><a class="text-decoration-none" routerLink="/identity-info">Home</a></li>
    <li class="breadcrumb-item">Requests</li>
    <li class="breadcrumb-item active" aria-current="page">Access Request Status</li>
  </ol>
</nav>
<!--Header row to show summary information currently does not filter by requestee-->
<div class=" form-group row" *ngIf="accessRequestStatuses && !loading">
  <div class="col-sm-3 text-start bg-dark text-white">
    <span class="fw-bold">Approval Summary</span>
  </div>
  <div class="col-sm-3 text-start bg-info text-white">
    <span class="fw-bold">Total Pending: {{ totalPending }} </span>
  </div>
  <div class="col-sm-3 text-start bg-success text-white">
    <span class="fw-bold">Total Approved: {{ totalApproved }} </span>
  </div>
  <div class="col-sm-3 bg-danger text-white text-start">
    <span class="fw-bold">Total Rejected: {{ totalRejected }} </span>
  </div>
</div>


<div class="row" *ngIf="accessRequestStatuses && !loading">
  <div class="col-sm-2 text-start">
    Total Records Found:
    {{page.xTotalCount}}
  </div>
  <div class="col-sm-2 text-start">
    Page:
    {{page.currentPage}} of {{page.totalPages}}
  </div>
  <nav aria-label="Page navigation">
    <ul class="pagination">
      <li class="page-item"><a class="page-link" href="javascript:void(0);" (click)="getPrevPage()">Previous</a></li>
      <li class="page-item" *ngFor="let item of page.paggination(); let i =index">
        <a class="page-link" href="javascript:void(0);" (click)="getOnePage(i)">{{i+1}}</a>
      </li>
      <li *ngIf="page.max==true" class="page-item">...</li>
      <li class="page-item"><a class="page-link" href="javascript:void(0);" (click)="getNextPage()">Next</a></li>

    </ul>
  </nav>

</div>
<!--Page Information-->

<!--Row of information-->
<div *ngIf="accessRequestStatuses && !loading" class="row" style="background-color: #EBEBEB">
  <div class="col-sm-8 text-start">
    <span class="fw-bold">This report shows access request status for tenant (latest 250 records). Use the search above
      to filter through them or the download button to export as CSV. You can also search 'Requested For' list on by
      searching by Account Name and clicking on 'Search'
    </span>
  </div>
  <div class="col-sm-1 text-end">
    <button type="button" (click)="saveInCsv()" class="btn btn-primary btn-sm">
      Download
    </button>
  </div>
  <div class="col-sm-1 text-end">
    <button type="button" [disabled]="loading" (click)="ngOnInit()" class="btn btn-primary btn-sm">
      Refresh
    </button>
  </div>
</div>
<p></p>
<div class="row ">
  <div class="col-md-3 bg-primary text-white">Search</div>
  <div class="col-md-9 bg-dark text-white">

  </div>
</div>

<form name="form" #f="ngForm" novalidate contactRequired>
  <div class="border border-primary">
    <div class="form-group align-items-center mb-3 ">
      <br>
      <div class="row">
        <div class="col-md-3">Current Page Record Search</div>
        <div class=" col-md-7">
          <div class="input-group ">
            <span class="input-group-text bg-white border-end-0">
              <i class="fa fa-search"></i>
            </span>
            <input class="form-control py-2 border-start-0 border" type="text" name="search" [(ngModel)]="searchText"
              autocomplete="off"
              placeholder="Access Name, Access Type, Request Type, Request State, Requester Name or Requested For Name to filter the result.">
          </div>
        </div>
      </div>
      <br>
      <!--Custom searches Currently only for Person -->
      <div class="row">
        <div class="col-md-3">Requested For List Only</div>
        <div class=" col-md-7">
          <input class="form-control py-2 border-start-0 border" type="text" name="requestedFor"
            [(ngModel)]="requestedFor" autocomplete="off" placeholder="Search via Account Name">
        </div>
        <div class="col-md-2">
          <button type="button" [disabled]="loading" (click)="getRequestedForUser()" class="btn btn-primary btn-sm">
            Search
          </button>
        </div>
      </div>
    </div>
  </div>
</form>
<div class="form-group row" *ngIf="loading">
  <div class="col-sm-10 text-start">
    <span class="fw-bold">Loading will take time... Please wait!!!</span>
  </div>
  <div class="col-sm-2 text-end">
    <span class="spinner-border spinner-border-sm me-1"></span>Loading...
  </div>
</div>


<br>
<table class="table table-striped table-bordered">
  <thead class="table-secondary text-center align-middle">
    <tr>
      <th scope="col" class="col-1">Access Name</th>
      <th scope="col" class="col-2">Access Type</th>
      <th scope="col" class="col-2">Request Type</th>
      <th scope="col" class="col-1">Request State</th>
      <th scope="col" class="col-1">SOD Violation</th>
      <th scope="col" class="col-1">Created</th>
      <th scope="col" class="col-2">Requester</th>
      <th scope="col" class="col-2">Requested For</th>
      <th scope="col" class="col-1">Requester Comment</th>
    </tr>
  </thead>
  <tbody class="text-center align-middle" *ngIf="accessRequestStatuses && !loading">
    <tr
      *ngFor="let i =index; let a of accessRequestStatuses | filter:searchText:['accessName', 'accessType', 'requestType', 'state', 'requester', 'requestedFor']; ">
      <td class="col-1">#{{i+1}}) {{ a.accessName }}</td>
      <td class="col-2">{{ a.accessType }}</td>
      <td class="col-2">{{ a.requestType }}</td>
      <td class="col-1">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-id="{{i}}"
          data-bs-target="#accessRequestDetails" (click)="pickData(i)">
          {{ a.state }}
        </button>
      </td>
      <td class="col-1">{{ a.sodViolationState }}</td>
      <td class="col-1">{{ a.created | date:'yyyy-MM-dd hh:mm:ss aa' }}</td>
      <td class="col-2">{{ a.requester }}</td>
      <td class="col-2">{{ a.requestedFor }}</td>
      <td class="col-2">{{ a.requesterComment }}</td>
    </tr>
  </tbody>
</table>
<br>


<!-- Button to Open the Modal -->


<!-- The Modal -->
<div class="modal" id="accessRequestDetails">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Approval Details</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <div class="text-center align-middle" *ngIf="accessRequestStatuses && !loading">
          <h1>Phases</h1>
          <hr>
          <div
            *ngFor="let i =index; let a of accessRequestStatuses | filter:searchText:['accessName', 'accessType', 'requestType', 'state', 'requester', 'requestedFor']">
            <div *ngFor="let item of a.accessRequestPhases; let x =index">
              <ul *ngIf="i==lineNumber">
                <li><b>{{item.name}}:</b>    {{item.state}}</li>
              </ul>
            </div>
          </div>

          <h1>Approval Status</h1>
          <hr>
          <div
          *ngFor="let i =index; let a of accessRequestStatuses | filter:searchText:['accessName', 'accessType', 'requestType', 'state', 'requester', 'requestedFor']">
          <div *ngFor="let item of a.approvalDetails; let x =index">
            <p *ngIf="i==lineNumber"><b>Approval:</b> {{item.scheme}}</p>
            <p *ngIf="i==lineNumber"><b>State:</b> {{item.status}}</p>
            <p *ngIf="i==lineNumber"><b>originalOwner:</b> {{item.originalOwner.name}}</p>
            <p *ngIf="i==lineNumber && item.currentOwner!=null"><b>currentOwner:</b> {{item.currentOwner.name}}</p>
          </div>
        </div>

        </div>

      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>