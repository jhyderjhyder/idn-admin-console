<nav class="navbar navbar-expand-lg navbar-light bg-light p-3 mb-3 rounded" aria-label="breadcrumb">
  <ol class="breadcrumb m-0">
    <li class="breadcrumb-item"><a class="text-decoration-none" routerLink="/identity-info">Home</a></li>
    <li class="breadcrumb-item">Identity Profiles</li>
    <li class="breadcrumb-item active" aria-current="page">Identity Info</li>
  </ol>
</nav>
<div class="form-group row" *ngIf="loading">
  <div class="col-sm-12 text-end">
    <span class="spinner-border spinner-border-sm me-1"></span>Loading...
  </div>
</div>
<!--Page Information-->
<div class="row" *ngIf="!loading && identityList">
  <div class="col-sm-2 text-start">
    Search Size:
    {{page.xTotalCount}}
  </div>
  <div class="col-sm-2 text-start">
    Page:
    {{page.pageNumber}} of {{page.totalPages}}
  </div>
  <div class="col-sm-1 text-start" *ngIf="page.hasMorePages">
    <button type="button" (click)='getNextPage()' class="btn btn-primary btn-sm">
      Next
    </button>
  </div>
</div>

<div class="row" *ngIf="!loading && identityList">
  <table class="table table-striped table-bordered">
    <tr>
      <td>Index</td>
      <td>Name</td>
      <td>Email</td>
      <td>Display Name</td>
      <td>Action</td>
    </tr>
    <tr *ngFor="let item of identityList; let i =index" >
      <td>{{ page.offset+1+i}} </td>
      <td>{{ item.name }}</td>
      <td>{{ item.email }}</td>
      <td>{{ item.displayName }}</td>
      <td>
        <!--This div tag is required or the button overflows-->
        <div>
        <button type="button" (click)='showDetailsFromList(i)' class="btn btn-primary btn-sm">
          Show Details
        </button>
      </div>
      </td>
    </tr>
  </table>
</div>
<div class="form-group row mb-3" *ngIf="!loading">
  <div class="col-sm-10 text-start">
    <span class="fw-bold">Enter Identity's Account Name (like *) and click the 'Search' button . 
      Or select another option to search based on firstname, lastname, identitficationNumber, email or phone.
       
      Click on the Manager's name (if exists) to get their details. 
      Click on 'Download' to save the report after Search</span>
  </div>
  <div class="col-sm-2 text-start">
    <button type="button" [disabled]="loading" (click)="ngOnInit()" class="btn btn-primary btn-sm">
      Reset
    </button>
  </div>
</div>
<!--Headers-->
<div class=" row mb-3 align-items-center bg-success text-white">
  <div class="col-sm-4 text-start">Search Text</div>
  <div class="col-sm-2 text-center">On</div>
  <div class="col-sm-2 text-end">Action</div>
</div>



<div class="form-group row mb-3 align-items-center" *ngIf="!loading">
  <div class="col-sm-4 text-start">
    <input id="accountName" class="form-control py-2 border-start-0 border" type="text" [(ngModel)]="accountName"
      placeholder="Enter Value">
  </div>

  <div *ngIf="!loading" class="col-sm-2 text-end">
    <label for="filterTypes">
      <select id="filterTypes" [(ngModel)]="selectedFilterTypes">
        <option *ngFor="let item of filterTypes">{{item}}</option>
      </select>
    </label>
  </div>

  <div class="col-sm-2 text-end">
    <button type="button" (click)="submit()" class="btn btn-primary btn-sm">
      Search
    </button>
  </div>

  <div class="col-sm-2 text-start">
    <button type="button" *ngIf="identityInfo" [disabled]="loading" (click)="refreshIdentity()"
      class="btn btn-primary btn-sm">
      Refresh Identity
    </button>
  </div>
  <div class="col-sm-2 text-start">
    <button type="button" *ngIf="identityInfo" [disabled]="loading" (click)="saveInCsv()"
      class="btn btn-primary btn-sm">
      Download
    </button>
  </div>
</div>

<div *ngIf="!loading && identityInfo">
<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="idDetails-tab" data-bs-toggle="tab" data-bs-target="#idDetails" 
    type="button" role="tab" aria-controls="home" aria-selected="true">Attributes</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="counts-tab" data-bs-toggle="tab" data-bs-target="#counts" 
    type="button" role="tab" aria-controls="counts" aria-selected="false">Counts</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="ownership-tab" data-bs-toggle="tab" data-bs-target="#ownership" 
    type="button" role="tab" aria-controls="ownership" aria-selected="false">Ownership</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="entitlements-tab" data-bs-toggle="tab" data-bs-target="#entitlements" 
    type="button" role="tab" aria-controls="entitlements" aria-selected="false">Entitlements</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="accounts-tab" data-bs-toggle="tab" data-bs-target="#accounts" 
    type="button" role="tab" aria-controls="accounts" aria-selected="false">Accounts</button>
  </li>
</ul>
<div class="tab-content" id="myTabContent">
  <div class="tab-pane fade show active" id="idDetails" role="tabpanel" aria-labelledby="home-tab">
  <p></p>
    <table class="table table-striped table-bordered" *ngIf="!loading && identityInfo">
      <thead class="table-secondary align-middle">
        <tr>
          <th scope="col" colspan="2">Identity Details</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>ID</td>
          <td>{{ identityInfo.id }}</td>
        </tr>
        <tr>
          <td>Display Name</td>
          <td>{{ identityInfo.displayName }}</td>
        </tr>
        <tr>
          <td>Employee Number</td>
          <td>{{ identityInfo.employeeNumber }}</td>
        </tr>
        <tr>
          <td>Email Address</td>
          <td>{{ identityInfo.email }}</td>
        </tr>
        <tr>
          <td>Lifecycle State</td>
          <td>{{ identityInfo.cloudLifecycleState }}</td>
        </tr>
        <tr>
          <td>Cloud Status</td>
          <td>{{ identityInfo.cloudStatus }}</td>
        </tr>
        <tr *ngIf="identityInfo.managerDisplayName">
          <td>Manager</td>
          <td style="color:royalblue; cursor: pointer;" (click)="getManagerInfo()">{{ identityInfo.managerDisplayName }}
          </td>
        </tr>
        <tr>
          <td>Created in IDN</td>
          <td>{{ identityInfo.created | date:'yyyy-MM-dd hh:mm:ss aa' }}</td>
        </tr>
        <tr>
          <td>Is A Manager</td>
          <td>{{ identityInfo.isManager }}</td>
        </tr>
        <tr>
          <td>Identity Profile</td>
          <td>{{ identityInfo.identityProfile }}</td>
        </tr>
        <tr>
          <td>Org Permission</td>
          <td>{{ identityInfo.orgPermission }}</td>
        </tr>
      </tbody>
     
    </table>
  </div>
  <!--End of the home Tab-->
  <div class="tab-pane fade" id="counts" role="tabpanel" aria-labelledby="counts-tab">
    <p></p>
    <table class="table table-striped table-bordered" *ngIf="!loading && identityInfo">
    <thead class="table-secondary align-middle">
      <tr>
        <th scope="col" colspan="2">Counts</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Accounts</td>
        <td>{{ identityInfo.accountCount }}</td>
      </tr>
      <tr *ngIf="identityInfo.accountSourceNames">
        <td>Account Source Names</td>
        <td>{{ identityInfo.accountSourceNames }}</td>
      </tr>
      <tr>
        <td>Applications</td>
        <td>{{ identityInfo.appCount }}</td>
      </tr>
      <tr *ngIf="identityInfo.appNames">
        <td>Application Names</td>
        <td>{{ identityInfo.appNames }}</td>
      </tr>
      <tr>
        <td>Total Access (Entitlements / AP / Roles)</td>
        <td>{{ identityInfo.accessCount }}</td>
      </tr>
      <tr>
        <td>Roles</td>
        <td>{{ identityInfo.roleCount }}</td>
      </tr>
      <tr *ngIf="identityInfo.roleNames">
        <td>Role Names</td>
        <td>{{ identityInfo.roleNames }}</td>
      </tr>
      <tr>
        <td>Access Profiles</td>
        <td>{{ identityInfo.accessProfileCount }}</td>
      </tr>
      <tr *ngIf="identityInfo.accessProfileNames">
        <td>Access Profile Names</td>
        <td>{{ identityInfo.accessProfileNames }}</td>
      </tr>
      <tr>
        <td>Entitlements</td>
        <td>{{ identityInfo.entitlementCount }}</td>
      </tr>
      <tr *ngIf="identityInfo.entitlementNames">
        <td>Entitlement Names</td>
        <td>{{ identityInfo.entitlementNames }}</td>
      </tr>
      <tr>
        <td>Tags</td>
        <td>{{ identityInfo.tagsCount }}</td>
      </tr>
      <tr *ngIf="identityInfo.tagNames">
        <td>Tag Names</td>
        <td>{{ identityInfo.tagNames }}</td>
      </tr>
    </tbody>
   
    
  </table>

  </div>
  <!--End of the Counts page-->
  <div class="tab-pane fade" id="ownership" role="tabpanel" aria-labelledby="ownership-tab">
    <p></p>
    <table class="table table-striped table-bordered" *ngIf="!loading && identityInfo">
      <thead class="table-secondary align-middle">
        <tr>
          <th scope="col" colspan="2">Owns</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Sources</td>
          <td>{{ identityInfo.ownSources }}</td>
        </tr>
        <tr *ngIf="identityInfo.ownSourcesNames">
          <td>Source Names</td>
          <td>{{ identityInfo.ownSourcesNames }}</td>
        </tr>
        <tr>
          <td>Access Profiles</td>
          <td>{{ identityInfo.ownAccessProfiles }}</td>
        </tr>
        <tr *ngIf="identityInfo.ownAccessProfilesNames">
          <td>Access Profiles Names</td>
          <td>{{ identityInfo.ownAccessProfilesNames }}</td>
        </tr>
        <tr>
          <td>Applications</td>
          <td>{{ identityInfo.ownApps }}</td>
        </tr>
        <tr *ngIf="identityInfo.ownAppsNames">
          <td>Application Names</td>
          <td>{{ identityInfo.ownAppsNames }}</td>
        </tr>
        <tr>
          <td>Roles</td>
          <td>{{ identityInfo.ownRoles }}</td>
        </tr>
        <tr *ngIf="identityInfo.ownRolesNames">
          <td>Role Names</td>
          <td>{{ identityInfo.ownRolesNames }}</td>
        </tr>
        <tr>
          <td>Governance Groups</td>
          <td>{{ identityInfo.ownGovernanceGroups }}</td>
        </tr>
        <tr *ngIf="identityInfo.ownGovernanceGroupsNames">
          <td>Governance Groups Names</td>
          <td>{{ identityInfo.ownGovernanceGroupsNames }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <!--End of the Ownership Details-->


  <div class="tab-pane fade" id="entitlements" role="tabpanel" aria-labelledby="Entitlements-tab">
    <p></p>
    <table class="table table-striped table-bordered" *ngIf="!loading && identityInfo">
      <thead class="table-secondary align-middle">
        <tr>
          <td>#</td>
          <td><b>Application</b></td>
          <td><b>Attribute</b></td>
          <td><b>DisplayName</b></td>
          <td><b>Description</b></td>
        </tr>
      </thead>
      <tbody>
        
        <tr *ngFor="let item of identityInfo.entitlementArray; let i =index" >
          <td>{{i+1}}</td>
          <td>{{item.sourceName}}</td>
          <td>{{item.attribute}}</td>
          <td>{{item.displayName}}</td>
          <td>{{item.description}}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <!--End of the Entitlements Details-->

  <div class="tab-pane fade" id="accounts" role="tabpanel" aria-labelledby="accounts-tab">
    <p></p>
    <table class="table table-striped table-bordered" *ngIf="!loading && identityInfo">
      <thead class="table-secondary align-middle">
        <tr>
          <td>#</td>
          <td><b>Application</b></td>
          <td><b>Account</b></td>
          <td><b>Disabled</b></td>
        </tr>
      </thead>
      <tbody>
        
        <tr *ngFor="let item of identityInfo.accountArray; let i =index" >
          <td>{{i+1}}</td>
          <td>{{item.sourceName}}</td>
          <td>{{item.accountName}}</td>
          <td>{{item.accountDisabled}}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <!--End of the Accounts Details-->

</div>
</div>